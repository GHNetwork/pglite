import{A as he,B as le,C as ye,D as pe,E as de,F as me,G as Ne,a as t,b as p,c as h,d as c,e as M,f as q,g as z,h as Y,i as _,j as $,k as j,l as J,m as X,n as Z,o as ee,p as te,q as re,r as ne,s as se,t as F,u as ie,v as ae,w as ue,x as oe,y as ce,z as fe}from"./chunk-REUDAHVV.js";function U(i){let e=i.length;for(let r=i.length-1;r>=0;r--){let n=i.charCodeAt(r);n>127&&n<=2047?e++:n>2047&&n<=65535&&(e+=2),n>=56320&&n<=57343&&r--}return e}var d,m,C,O,L,g,P,I,be,S=class{constructor(e=256){this.size=e;p(this,g);p(this,d);p(this,m,5);p(this,C,!1);p(this,O,new TextEncoder);p(this,L,0);h(this,d,c(this,g,P).call(this,e))}addInt32(e){return c(this,g,I).call(this,4),t(this,d).setInt32(t(this,m),e,t(this,C)),h(this,m,t(this,m)+4),this}addInt16(e){return c(this,g,I).call(this,2),t(this,d).setInt16(t(this,m),e,t(this,C)),h(this,m,t(this,m)+2),this}addCString(e){return e&&this.addString(e),c(this,g,I).call(this,1),t(this,d).setUint8(t(this,m),0),M(this,m)._++,this}addString(e=""){let r=U(e);return c(this,g,I).call(this,r),t(this,O).encodeInto(e,new Uint8Array(t(this,d).buffer,t(this,m))),h(this,m,t(this,m)+r),this}add(e){let r=e instanceof Uint8Array?e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength):e;return c(this,g,I).call(this,r.byteLength),new Uint8Array(t(this,d).buffer).set(new Uint8Array(r),t(this,m)),h(this,m,t(this,m)+r.byteLength),this}flush(e){let r=c(this,g,be).call(this,e);return h(this,m,5),h(this,d,c(this,g,P).call(this,this.size)),new Uint8Array(r)}};d=new WeakMap,m=new WeakMap,C=new WeakMap,O=new WeakMap,L=new WeakMap,g=new WeakSet,P=function(e){return new DataView(new ArrayBuffer(e))},I=function(e){if(t(this,d).byteLength-t(this,m)<e){let n=t(this,d).buffer,s=n.byteLength+(n.byteLength>>1)+e;h(this,d,c(this,g,P).call(this,s)),new Uint8Array(t(this,d).buffer).set(new Uint8Array(n))}},be=function(e){if(e){t(this,d).setUint8(t(this,L),e);let r=t(this,m)-(t(this,L)+1);t(this,d).setInt32(t(this,L)+1,r,t(this,C))}return t(this,d).buffer.slice(e?0:5,t(this,m))};var y=new S,Ee=i=>{y.addInt16(3).addInt16(0);for(let n of Object.keys(i))y.addCString(n).addCString(i[n]);y.addCString("client_encoding").addCString("UTF8");let e=y.addCString("").flush(),r=e.byteLength+4;return new S().addInt32(r).add(e).flush()},Te=()=>{let i=new DataView(new ArrayBuffer(8));return i.setInt32(0,8,!1),i.setInt32(4,80877103,!1),new Uint8Array(i.buffer)},Fe=i=>y.addCString(i).flush(112),ve=(i,e)=>(y.addCString(i).addInt32(U(e)).addString(e),y.flush(112)),Qe=i=>y.addString(i).flush(112),We=i=>y.addCString(i).flush(81),Ge=[],He=i=>{let e=i.name??"";e.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",e,e.length),console.error("This can cause conflicts and silent errors executing queries"));let r=y.addCString(e).addCString(i.text).addInt16(i.types?.length??0);return i.types?.forEach(n=>r.addInt32(n)),y.flush(80)},V=new S;var Ke=(i,e)=>{for(let r=0;r<i.length;r++){let n=e?e(i[r],r):i[r];if(n===null)y.addInt16(0),V.addInt32(-1);else if(n instanceof ArrayBuffer||ArrayBuffer.isView(n)){let s=ArrayBuffer.isView(n)?n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength):n;y.addInt16(1),V.addInt32(s.byteLength),V.add(s)}else y.addInt16(0),V.addInt32(U(n)),V.addString(n)}},qe=(i={})=>{let e=i.portal??"",r=i.statement??"",n=i.binary??!1,s=i.values??Ge,a=s.length;return y.addCString(e).addCString(r),y.addInt16(a),Ke(s,i.valueMapper),y.addInt16(a),y.add(V.flush()),y.addInt16(n?1:0),y.flush(66)},ze=new Uint8Array([69,0,0,0,9,0,0,0,0,0]),Ye=i=>{if(!i||!i.portal&&!i.rows)return ze;let e=i.portal??"",r=i.rows??0,n=U(e),s=4+n+1+4,a=new DataView(new ArrayBuffer(1+s));return a.setUint8(0,69),a.setInt32(1,s,!1),new TextEncoder().encodeInto(e,new Uint8Array(a.buffer,5)),a.setUint8(n+5,0),a.setUint32(a.byteLength-4,r,!1),new Uint8Array(a.buffer)},_e=(i,e)=>{let r=new DataView(new ArrayBuffer(16));return r.setInt32(0,16,!1),r.setInt16(4,1234,!1),r.setInt16(6,5678,!1),r.setInt32(8,i,!1),r.setInt32(12,e,!1),new Uint8Array(r.buffer)},v=(i,e)=>{let r=new S;return r.addCString(e),r.flush(i)},$e=y.addCString("P").flush(68),je=y.addCString("S").flush(68),Je=i=>i.name?v(68,`${i.type}${i.name??""}`):i.type==="P"?$e:je,Xe=i=>{let e=`${i.type}${i.name??""}`;return v(67,e)},Ze=i=>y.add(i).flush(100),et=i=>v(102,i),k=i=>new Uint8Array([i,0,0,0,4]),tt=k(72),rt=k(83),nt=k(88),st=k(99),it={startup:Ee,password:Fe,requestSsl:Te,sendSASLInitialResponseMessage:ve,sendSCRAMClientFinalMessage:Qe,query:We,parse:He,bind:qe,execute:Ye,describe:Je,close:Xe,flush:()=>tt,sync:()=>rt,end:()=>nt,copyData:Ze,copyDone:()=>st,copyFail:et,cancel:_e};var Q={text:0,binary:1};var at=new ArrayBuffer(0),D,b,E,T,R,N=class{constructor(e=0){p(this,D,new DataView(at));p(this,b);p(this,E,"utf-8");p(this,T,new TextDecoder(t(this,E)));p(this,R,!1);h(this,b,e)}setBuffer(e,r){h(this,b,e),h(this,D,new DataView(r))}int16(){let e=t(this,D).getInt16(t(this,b),t(this,R));return h(this,b,t(this,b)+2),e}byte(){let e=t(this,D).getUint8(t(this,b));return M(this,b)._++,e}int32(){let e=t(this,D).getInt32(t(this,b),t(this,R));return h(this,b,t(this,b)+4),e}string(e){return t(this,T).decode(this.bytes(e))}cstring(){let e=t(this,b),r=e;for(;t(this,D).getUint8(r++)!==0;);let n=this.string(r-e-1);return h(this,b,r),n}bytes(e){let r=t(this,D).buffer.slice(t(this,b),t(this,b)+e);return h(this,b,t(this,b)+e),new Uint8Array(r)}};D=new WeakMap,b=new WeakMap,E=new WeakMap,T=new WeakMap,R=new WeakMap;var W=1,ut=4,we=W+ut,ge=new ArrayBuffer(0);var w,x,B,u,o,Ae,xe,Be,De,Se,Ue,Ie,H,Ce,Le,Ve,Re,Me,Pe,Oe,ke,K,G=class{constructor(){p(this,o);p(this,w,new DataView(ge));p(this,x,0);p(this,B,0);p(this,u,new N)}parse(e,r){c(this,o,Ae).call(this,ArrayBuffer.isView(e)?e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength):e);let n=t(this,B)+t(this,x),s=t(this,B);for(;s+we<=n;){let a=t(this,w).getUint8(s),f=t(this,w).getUint32(s+W,!1),A=W+f;if(A+s<=n&&f>0){let l=c(this,o,xe).call(this,s+we,a,f,t(this,w).buffer);r(l),s+=A}else break}s===n?(h(this,w,new DataView(ge)),h(this,x,0),h(this,B,0)):(h(this,x,n-s),h(this,B,s))}};w=new WeakMap,x=new WeakMap,B=new WeakMap,u=new WeakMap,o=new WeakSet,Ae=function(e){if(t(this,x)>0){let r=t(this,x)+e.byteLength;if(r+t(this,B)>t(this,w).byteLength){let s;if(r<=t(this,w).byteLength&&t(this,B)>=t(this,x))s=t(this,w).buffer;else{let a=t(this,w).byteLength*2;for(;r>=a;)a*=2;s=new ArrayBuffer(a)}new Uint8Array(s).set(new Uint8Array(t(this,w).buffer,t(this,B),t(this,x))),h(this,w,new DataView(s)),h(this,B,0)}new Uint8Array(t(this,w).buffer).set(new Uint8Array(e),t(this,B)+t(this,x)),h(this,x,r)}else h(this,w,new DataView(e)),h(this,B,0),h(this,x,e.byteLength)},xe=function(e,r,n,s){switch(r){case 50:return z;case 49:return q;case 51:return Y;case 110:return _;case 115:return $;case 99:return X;case 87:return j;case 73:return J;case 68:return c(this,o,Me).call(this,e,n,s);case 67:return c(this,o,De).call(this,e,n,s);case 90:return c(this,o,Be).call(this,e,n,s);case 65:return c(this,o,Ce).call(this,e,n,s);case 82:return c(this,o,ke).call(this,e,n,s);case 83:return c(this,o,Pe).call(this,e,n,s);case 75:return c(this,o,Oe).call(this,e,n,s);case 69:return c(this,o,K).call(this,e,n,s,"error");case 78:return c(this,o,K).call(this,e,n,s,"notice");case 84:return c(this,o,Le).call(this,e,n,s);case 116:return c(this,o,Re).call(this,e,n,s);case 71:return c(this,o,Ue).call(this,e,n,s);case 72:return c(this,o,Ie).call(this,e,n,s);case 100:return c(this,o,Se).call(this,e,n,s);default:return new F("received invalid response: "+r.toString(16),n,"error")}},Be=function(e,r,n){t(this,u).setBuffer(e,n);let s=t(this,u).string(1);return new ye(r,s)},De=function(e,r,n){t(this,u).setBuffer(e,n);let s=t(this,u).cstring();return new pe(r,s)},Se=function(e,r,n){let s=n.slice(e,e+(r-4));return new ie(r,new Uint8Array(s))},Ue=function(e,r,n){return c(this,o,H).call(this,e,r,n,"copyInResponse")},Ie=function(e,r,n){return c(this,o,H).call(this,e,r,n,"copyOutResponse")},H=function(e,r,n,s){t(this,u).setBuffer(e,n);let a=t(this,u).byte()!==0,f=t(this,u).int16(),A=new ae(r,s,a,f);for(let l=0;l<f;l++)A.columnTypes[l]=t(this,u).int16();return A},Ce=function(e,r,n){t(this,u).setBuffer(e,n);let s=t(this,u).int32(),a=t(this,u).cstring(),f=t(this,u).cstring();return new le(r,s,a,f)},Le=function(e,r,n){t(this,u).setBuffer(e,n);let s=t(this,u).int16(),a=new oe(r,s);for(let f=0;f<s;f++)a.fields[f]=c(this,o,Ve).call(this);return a},Ve=function(){let e=t(this,u).cstring(),r=t(this,u).int32(),n=t(this,u).int16(),s=t(this,u).int32(),a=t(this,u).int16(),f=t(this,u).int32(),A=t(this,u).int16()===0?Q.text:Q.binary;return new ue(e,r,n,s,a,f,A)},Re=function(e,r,n){t(this,u).setBuffer(e,n);let s=t(this,u).int16(),a=new ce(r,s);for(let f=0;f<s;f++)a.dataTypeIDs[f]=t(this,u).int32();return a},Me=function(e,r,n){t(this,u).setBuffer(e,n);let s=t(this,u).int16(),a=new Array(s);for(let f=0;f<s;f++){let A=t(this,u).int32();a[f]=A===-1?null:t(this,u).string(A)}return new de(r,a)},Pe=function(e,r,n){t(this,u).setBuffer(e,n);let s=t(this,u).cstring(),a=t(this,u).cstring();return new fe(r,s,a)},Oe=function(e,r,n){t(this,u).setBuffer(e,n);let s=t(this,u).int32(),a=t(this,u).int32();return new he(r,s,a)},ke=function(e,r,n){t(this,u).setBuffer(e,n);let s=t(this,u).int32();switch(s){case 0:return new Z(r);case 3:return new ee(r);case 5:return new te(r,t(this,u).bytes(4));case 10:{let a=[];for(;;){let f=t(this,u).cstring();if(f.length===0)return new re(r,a);a.push(f)}}case 11:return new ne(r,t(this,u).string(r-8));case 12:return new se(r,t(this,u).string(r-8));default:throw new Error("Unknown authenticationOk message type "+s)}},K=function(e,r,n,s){t(this,u).setBuffer(e,n);let a={},f=t(this,u).string(1);for(;f!=="\0";)a[f]=t(this,u).cstring(),f=t(this,u).string(1);let A=a.M,l=s==="notice"?new me(r,A):new F(A,r,s);return l.severity=a.S,l.code=a.C,l.detail=a.D,l.hint=a.H,l.position=a.P,l.internalPosition=a.p,l.internalQuery=a.q,l.where=a.W,l.schema=a.s,l.table=a.t,l.column=a.c,l.dataType=a.d,l.constraint=a.n,l.file=a.F,l.line=a.L,l.routine=a.R,l};export{G as Parser,Ne as messages,it as serialize};
//# sourceMappingURL=index.js.map