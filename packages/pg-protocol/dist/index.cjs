"use strict";var se=Object.defineProperty;var We=Object.getOwnPropertyDescriptor;var Ge=Object.getOwnPropertyNames;var Ke=Object.prototype.hasOwnProperty;var xe=r=>{throw TypeError(r)};var Ae=(r,e)=>{for(var t in e)se(r,t,{get:e[t],enumerable:!0})},ze=(r,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of Ge(e))!Ke.call(r,i)&&i!==t&&se(r,i,{get:()=>e[i],enumerable:!(s=We(e,i))||s.enumerable});return r};var He=r=>ze(se({},"__esModule",{value:!0}),r);var ie=(r,e,t)=>e.has(r)||xe("Cannot "+t);var n=(r,e,t)=>(ie(r,e,"read from private field"),t?t.call(r):e.get(r)),y=(r,e,t)=>e.has(r)?xe("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),l=(r,e,t,s)=>(ie(r,e,"write to private field"),s?s.call(r,t):e.set(r,t),t),d=(r,e,t)=>(ie(r,e,"access private method"),t);var j=(r,e,t,s)=>({set _(i){l(r,e,i,t)},get _(){return n(r,e,s)}});var bt={};Ae(bt,{Parser:()=>re,messages:()=>me,serialize:()=>De});module.exports=He(bt);function M(r){let e=r.length;for(let t=r.length-1;t>=0;t--){let s=r.charCodeAt(t);s>127&&s<=2047?e++:s>2047&&s<=65535&&(e+=2),s>=56320&&s<=57343&&t--}return e}var m,h,I,X,U,x,J,C,Be,S=class{constructor(e=256){this.size=e;y(this,x);y(this,m);y(this,h,5);y(this,I,!1);y(this,X,new TextEncoder);y(this,U,0);l(this,m,d(this,x,J).call(this,e))}addInt32(e){return d(this,x,C).call(this,4),n(this,m).setInt32(n(this,h),e,n(this,I)),l(this,h,n(this,h)+4),this}addInt16(e){return d(this,x,C).call(this,2),n(this,m).setInt16(n(this,h),e,n(this,I)),l(this,h,n(this,h)+2),this}addCString(e){return e&&this.addString(e),d(this,x,C).call(this,1),n(this,m).setUint8(n(this,h),0),j(this,h)._++,this}addString(e=""){let t=M(e);return d(this,x,C).call(this,t),n(this,X).encodeInto(e,new Uint8Array(n(this,m).buffer,n(this,h))),l(this,h,n(this,h)+t),this}add(e){let t=e instanceof Uint8Array?e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength):e;return d(this,x,C).call(this,t.byteLength),new Uint8Array(n(this,m).buffer).set(new Uint8Array(t),n(this,h)),l(this,h,n(this,h)+t.byteLength),this}flush(e){let t=d(this,x,Be).call(this,e);return l(this,h,5),l(this,m,d(this,x,J).call(this,this.size)),new Uint8Array(t)}};m=new WeakMap,h=new WeakMap,I=new WeakMap,X=new WeakMap,U=new WeakMap,x=new WeakSet,J=function(e){return new DataView(new ArrayBuffer(e))},C=function(e){if(n(this,m).byteLength-n(this,h)<e){let s=n(this,m).buffer,i=s.byteLength+(s.byteLength>>1)+e;l(this,m,d(this,x,J).call(this,i)),new Uint8Array(n(this,m).buffer).set(new Uint8Array(s))}},Be=function(e){if(e){n(this,m).setUint8(n(this,U),e);let t=n(this,h)-(n(this,U)+1);n(this,m).setInt32(n(this,U)+1,t,n(this,I))}return n(this,m).buffer.slice(e?0:5,n(this,h))};var f=new S,qe=r=>{f.addInt16(3).addInt16(0);for(let s of Object.keys(r))f.addCString(s).addCString(r[s]);f.addCString("client_encoding").addCString("UTF8");let e=f.addCString("").flush(),t=e.byteLength+4;return new S().addInt32(t).add(e).flush()},Ye=()=>{let r=new DataView(new ArrayBuffer(8));return r.setInt32(0,8,!1),r.setInt32(4,80877103,!1),new Uint8Array(r.buffer)},_e=r=>f.addCString(r).flush(112),$e=(r,e)=>(f.addCString(r).addInt32(M(e)).addString(e),f.flush(112)),je=r=>f.addString(r).flush(112),Je=r=>f.addCString(r).flush(81),Xe=[],Ze=r=>{let e=r.name??"";e.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",e,e.length),console.error("This can cause conflicts and silent errors executing queries"));let t=f.addCString(e).addCString(r.text).addInt16(r.types?.length??0);return r.types?.forEach(s=>t.addInt32(s)),f.flush(80)},k=new S;var et=(r,e)=>{for(let t=0;t<r.length;t++){let s=e?e(r[t],t):r[t];if(s===null)f.addInt16(0),k.addInt32(-1);else if(s instanceof ArrayBuffer||ArrayBuffer.isView(s)){let i=ArrayBuffer.isView(s)?s.buffer.slice(s.byteOffset,s.byteOffset+s.byteLength):s;f.addInt16(1),k.addInt32(i.byteLength),k.add(i)}else f.addInt16(0),k.addInt32(M(s)),k.addString(s)}},tt=(r={})=>{let e=r.portal??"",t=r.statement??"",s=r.binary??!1,i=r.values??Xe,a=i.length;return f.addCString(e).addCString(t),f.addInt16(a),et(i,r.valueMapper),f.addInt16(a),f.add(k.flush()),f.addInt16(s?1:0),f.flush(66)},nt=new Uint8Array([69,0,0,0,9,0,0,0,0,0]),rt=r=>{if(!r||!r.portal&&!r.rows)return nt;let e=r.portal??"",t=r.rows??0,s=M(e),i=4+s+1+4,a=new DataView(new ArrayBuffer(1+i));return a.setUint8(0,69),a.setInt32(1,i,!1),new TextEncoder().encodeInto(e,new Uint8Array(a.buffer,5)),a.setUint8(s+5,0),a.setUint32(a.byteLength-4,t,!1),new Uint8Array(a.buffer)},st=(r,e)=>{let t=new DataView(new ArrayBuffer(16));return t.setInt32(0,16,!1),t.setInt16(4,1234,!1),t.setInt16(6,5678,!1),t.setInt32(8,r,!1),t.setInt32(12,e,!1),new Uint8Array(t.buffer)},ae=(r,e)=>{let t=new S;return t.addCString(e),t.flush(r)},it=f.addCString("P").flush(68),at=f.addCString("S").flush(68),ut=r=>r.name?ae(68,`${r.type}${r.name??""}`):r.type==="P"?it:at,ot=r=>{let e=`${r.type}${r.name??""}`;return ae(67,e)},ct=r=>f.add(r).flush(100),lt=r=>ae(102,r),Z=r=>new Uint8Array([r,0,0,0,4]),dt=Z(72),pt=Z(83),ft=Z(88),yt=Z(99),De={startup:qe,password:_e,requestSsl:Ye,sendSASLInitialResponseMessage:$e,sendSCRAMClientFinalMessage:je,query:Je,parse:Ze,bind:tt,execute:rt,describe:ut,close:ot,flush:()=>dt,sync:()=>pt,end:()=>ft,copyData:ct,copyDone:()=>yt,copyFail:lt,cancel:st};var me={};Ae(me,{AuthenticationCleartextPassword:()=>V,AuthenticationMD5Password:()=>N,AuthenticationOk:()=>P,AuthenticationSASL:()=>R,AuthenticationSASLContinue:()=>O,AuthenticationSASLFinal:()=>T,BackendKeyDataMessage:()=>K,CommandCompleteMessage:()=>q,CopyDataMessage:()=>E,CopyResponse:()=>F,DataRowMessage:()=>Y,DatabaseError:()=>L,Field:()=>v,NoticeMessage:()=>_,NotificationResponseMessage:()=>z,ParameterDescriptionMessage:()=>W,ParameterStatusMessage:()=>G,ReadyForQueryMessage:()=>H,RowDescriptionMessage:()=>Q,bindComplete:()=>oe,closeComplete:()=>ce,copyDone:()=>ye,emptyQuery:()=>fe,noData:()=>le,parseComplete:()=>ue,portalSuspended:()=>de,replicationStart:()=>pe});var ue={name:"parseComplete",length:5},oe={name:"bindComplete",length:5},ce={name:"closeComplete",length:5},le={name:"noData",length:5},de={name:"portalSuspended",length:5},pe={name:"replicationStart",length:4},fe={name:"emptyQuery",length:4},ye={name:"copyDone",length:4},P=class{constructor(e){this.length=e;this.name="authenticationOk"}},V=class{constructor(e){this.length=e;this.name="authenticationCleartextPassword"}},N=class{constructor(e,t){this.length=e;this.salt=t;this.name="authenticationMD5Password"}},R=class{constructor(e,t){this.length=e;this.mechanisms=t;this.name="authenticationSASL"}},O=class{constructor(e,t){this.length=e;this.data=t;this.name="authenticationSASLContinue"}},T=class{constructor(e,t){this.length=e;this.data=t;this.name="authenticationSASLFinal"}},L=class extends Error{constructor(t,s,i){super(t);this.length=s;this.name=i}},E=class{constructor(e,t){this.length=e;this.chunk=t;this.name="copyData"}},F=class{constructor(e,t,s,i){this.length=e;this.name=t;this.binary=s;this.columnTypes=new Array(i)}},v=class{constructor(e,t,s,i,a,c,w){this.name=e;this.tableID=t;this.columnID=s;this.dataTypeID=i;this.dataTypeSize=a;this.dataTypeModifier=c;this.format=w}},Q=class{constructor(e,t){this.length=e;this.fieldCount=t;this.name="rowDescription";this.fields=new Array(this.fieldCount)}},W=class{constructor(e,t){this.length=e;this.parameterCount=t;this.name="parameterDescription";this.dataTypeIDs=new Array(this.parameterCount)}},G=class{constructor(e,t,s){this.length=e;this.parameterName=t;this.parameterValue=s;this.name="parameterStatus"}},K=class{constructor(e,t,s){this.length=e;this.processID=t;this.secretKey=s;this.name="backendKeyData"}},z=class{constructor(e,t,s,i){this.length=e;this.processId=t;this.channel=s;this.payload=i;this.name="notification"}},H=class{constructor(e,t){this.length=e;this.status=t;this.name="readyForQuery"}},q=class{constructor(e,t){this.length=e;this.text=t;this.name="commandComplete"}},Y=class{constructor(e,t){this.length=e;this.fields=t;this.name="dataRow";this.fieldCount=t.length}},_=class{constructor(e,t){this.length=e;this.message=t;this.name="notice"}};var he={text:0,binary:1};var mt=new ArrayBuffer(0),D,b,te,ne,$,ee=class{constructor(e=0){y(this,D,new DataView(mt));y(this,b);y(this,te,"utf-8");y(this,ne,new TextDecoder(n(this,te)));y(this,$,!1);l(this,b,e)}setBuffer(e,t){l(this,b,e),l(this,D,new DataView(t))}int16(){let e=n(this,D).getInt16(n(this,b),n(this,$));return l(this,b,n(this,b)+2),e}byte(){let e=n(this,D).getUint8(n(this,b));return j(this,b)._++,e}int32(){let e=n(this,D).getInt32(n(this,b),n(this,$));return l(this,b,n(this,b)+4),e}string(e){return n(this,ne).decode(this.bytes(e))}cstring(){let e=n(this,b),t=e;for(;n(this,D).getUint8(t++)!==0;);let s=this.string(t-e-1);return l(this,b,t),s}bytes(e){let t=n(this,D).buffer.slice(n(this,b),n(this,b)+e);return l(this,b,n(this,b)+e),new Uint8Array(t)}};D=new WeakMap,b=new WeakMap,te=new WeakMap,ne=new WeakMap,$=new WeakMap;var be=1,ht=4,Se=be+ht,Me=new ArrayBuffer(0);var g,A,B,u,o,Ce,Ie,Ue,ke,Le,Pe,Ve,ge,Ne,Re,Oe,Te,Ee,Fe,ve,Qe,we,re=class{constructor(){y(this,o);y(this,g,new DataView(Me));y(this,A,0);y(this,B,0);y(this,u,new ee)}parse(e,t){d(this,o,Ce).call(this,ArrayBuffer.isView(e)?e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength):e);let s=n(this,B)+n(this,A),i=n(this,B);for(;i+Se<=s;){let a=n(this,g).getUint8(i),c=n(this,g).getUint32(i+be,!1),w=be+c;if(w+i<=s&&c>0){let p=d(this,o,Ie).call(this,i+Se,a,c,n(this,g).buffer);t(p),i+=w}else break}i===s?(l(this,g,new DataView(Me)),l(this,A,0),l(this,B,0)):(l(this,A,s-i),l(this,B,i))}};g=new WeakMap,A=new WeakMap,B=new WeakMap,u=new WeakMap,o=new WeakSet,Ce=function(e){if(n(this,A)>0){let t=n(this,A)+e.byteLength;if(t+n(this,B)>n(this,g).byteLength){let i;if(t<=n(this,g).byteLength&&n(this,B)>=n(this,A))i=n(this,g).buffer;else{let a=n(this,g).byteLength*2;for(;t>=a;)a*=2;i=new ArrayBuffer(a)}new Uint8Array(i).set(new Uint8Array(n(this,g).buffer,n(this,B),n(this,A))),l(this,g,new DataView(i)),l(this,B,0)}new Uint8Array(n(this,g).buffer).set(new Uint8Array(e),n(this,B)+n(this,A)),l(this,A,t)}else l(this,g,new DataView(e)),l(this,B,0),l(this,A,e.byteLength)},Ie=function(e,t,s,i){switch(t){case 50:return oe;case 49:return ue;case 51:return ce;case 110:return le;case 115:return de;case 99:return ye;case 87:return pe;case 73:return fe;case 68:return d(this,o,Ee).call(this,e,s,i);case 67:return d(this,o,ke).call(this,e,s,i);case 90:return d(this,o,Ue).call(this,e,s,i);case 65:return d(this,o,Ne).call(this,e,s,i);case 82:return d(this,o,Qe).call(this,e,s,i);case 83:return d(this,o,Fe).call(this,e,s,i);case 75:return d(this,o,ve).call(this,e,s,i);case 69:return d(this,o,we).call(this,e,s,i,"error");case 78:return d(this,o,we).call(this,e,s,i,"notice");case 84:return d(this,o,Re).call(this,e,s,i);case 116:return d(this,o,Te).call(this,e,s,i);case 71:return d(this,o,Pe).call(this,e,s,i);case 72:return d(this,o,Ve).call(this,e,s,i);case 100:return d(this,o,Le).call(this,e,s,i);default:return new L("received invalid response: "+t.toString(16),s,"error")}},Ue=function(e,t,s){n(this,u).setBuffer(e,s);let i=n(this,u).string(1);return new H(t,i)},ke=function(e,t,s){n(this,u).setBuffer(e,s);let i=n(this,u).cstring();return new q(t,i)},Le=function(e,t,s){let i=s.slice(e,e+(t-4));return new E(t,new Uint8Array(i))},Pe=function(e,t,s){return d(this,o,ge).call(this,e,t,s,"copyInResponse")},Ve=function(e,t,s){return d(this,o,ge).call(this,e,t,s,"copyOutResponse")},ge=function(e,t,s,i){n(this,u).setBuffer(e,s);let a=n(this,u).byte()!==0,c=n(this,u).int16(),w=new F(t,i,a,c);for(let p=0;p<c;p++)w.columnTypes[p]=n(this,u).int16();return w},Ne=function(e,t,s){n(this,u).setBuffer(e,s);let i=n(this,u).int32(),a=n(this,u).cstring(),c=n(this,u).cstring();return new z(t,i,a,c)},Re=function(e,t,s){n(this,u).setBuffer(e,s);let i=n(this,u).int16(),a=new Q(t,i);for(let c=0;c<i;c++)a.fields[c]=d(this,o,Oe).call(this);return a},Oe=function(){let e=n(this,u).cstring(),t=n(this,u).int32(),s=n(this,u).int16(),i=n(this,u).int32(),a=n(this,u).int16(),c=n(this,u).int32(),w=n(this,u).int16()===0?he.text:he.binary;return new v(e,t,s,i,a,c,w)},Te=function(e,t,s){n(this,u).setBuffer(e,s);let i=n(this,u).int16(),a=new W(t,i);for(let c=0;c<i;c++)a.dataTypeIDs[c]=n(this,u).int32();return a},Ee=function(e,t,s){n(this,u).setBuffer(e,s);let i=n(this,u).int16(),a=new Array(i);for(let c=0;c<i;c++){let w=n(this,u).int32();a[c]=w===-1?null:n(this,u).string(w)}return new Y(t,a)},Fe=function(e,t,s){n(this,u).setBuffer(e,s);let i=n(this,u).cstring(),a=n(this,u).cstring();return new G(t,i,a)},ve=function(e,t,s){n(this,u).setBuffer(e,s);let i=n(this,u).int32(),a=n(this,u).int32();return new K(t,i,a)},Qe=function(e,t,s){n(this,u).setBuffer(e,s);let i=n(this,u).int32();switch(i){case 0:return new P(t);case 3:return new V(t);case 5:return new N(t,n(this,u).bytes(4));case 10:{let a=[];for(;;){let c=n(this,u).cstring();if(c.length===0)return new R(t,a);a.push(c)}}case 11:return new O(t,n(this,u).string(t-8));case 12:return new T(t,n(this,u).string(t-8));default:throw new Error("Unknown authenticationOk message type "+i)}},we=function(e,t,s,i){n(this,u).setBuffer(e,s);let a={},c=n(this,u).string(1);for(;c!=="\0";)a[c]=n(this,u).cstring(),c=n(this,u).string(1);let w=a.M,p=i==="notice"?new _(t,w):new L(w,t,i);return p.severity=a.S,p.code=a.C,p.detail=a.D,p.hint=a.H,p.position=a.P,p.internalPosition=a.p,p.internalQuery=a.q,p.where=a.W,p.schema=a.s,p.table=a.t,p.column=a.c,p.dataType=a.d,p.constraint=a.n,p.file=a.F,p.line=a.L,p.routine=a.R,p};0&&(module.exports={Parser,messages,serialize});
//# sourceMappingURL=index.cjs.map