"use strict";var dr=Object.create;var N=Object.defineProperty;var mr=Object.getOwnPropertyDescriptor;var fr=Object.getOwnPropertyNames;var gr=Object.getPrototypeOf,yr=Object.prototype.hasOwnProperty;var hr=(r,e)=>()=>(r&&(e=r(r=0)),e);var T=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),Sr=(r,e)=>{for(var t in e)N(r,t,{get:e[t],enumerable:!0})},W=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of fr(e))!yr.call(r,i)&&i!==t&&N(r,i,{get:()=>e[i],enumerable:!(n=mr(e,i))||n.enumerable});return r};var E=(r,e,t)=>(t=r!=null?dr(gr(r)):{},W(e||!r||!r.__esModule?N(t,"default",{value:r,enumerable:!0}):t,r)),br=r=>W(N({},"__esModule",{value:!0}),r);var u=hr(()=>{"use strict"});var A=T((ie,l)=>{"use strict";u();var Y=9007199254740991,V=(function(r){return r})();function Fr(r){return r===V}function X(r){return typeof r=="string"||Object.prototype.toString.call(r)=="[object String]"}function Tr(r){return Object.prototype.toString.call(r)=="[object Date]"}function U(r){return r!==null&&typeof r=="object"}function _(r){return typeof r=="function"}function Pr(r){return typeof r=="number"&&r>-1&&r%1==0&&r<=Y}function Er(r){return Object.prototype.toString.call(r)=="[object Array]"}function K(r){return U(r)&&!_(r)&&Pr(r.length)}function R(r){return Object.prototype.toString.call(r)=="[object ArrayBuffer]"}function Ar(r,e){return Array.prototype.map.call(r,e)}function wr(r,e){var t=V;return _(e)&&Array.prototype.every.call(r,function(n,i,a){var s=e(n,i,a);return s&&(t=n),!s}),t}function xr(r){return Object.assign.apply(null,arguments)}function Z(r){var e,t,n;if(X(r)){for(t=r.length,n=new Uint8Array(t),e=0;e<t;e++)n[e]=r.charCodeAt(e)&255;return n}return R(r)?new Uint8Array(r):U(r)&&R(r.buffer)?new Uint8Array(r.buffer):K(r)?new Uint8Array(r):U(r)&&_(r.toString)?Z(r.toString()):new Uint8Array}l.exports.MAX_SAFE_INTEGER=Y;l.exports.isUndefined=Fr;l.exports.isString=X;l.exports.isObject=U;l.exports.isDateTime=Tr;l.exports.isFunction=_;l.exports.isArray=Er;l.exports.isArrayLike=K;l.exports.isArrayBuffer=R;l.exports.map=Ar;l.exports.find=wr;l.exports.extend=xr;l.exports.toUint8Array=Z});var w=T((ae,J)=>{"use strict";u();var L="\0";J.exports={NULL_CHAR:L,TMAGIC:"ustar"+L+"00",OLDGNU_MAGIC:"ustar  "+L,REGTYPE:0,LNKTYPE:1,SYMTYPE:2,CHRTYPE:3,BLKTYPE:4,DIRTYPE:5,FIFOTYPE:6,CONTTYPE:7,TSUID:parseInt("4000",8),TSGID:parseInt("2000",8),TSVTX:parseInt("1000",8),TUREAD:parseInt("0400",8),TUWRITE:parseInt("0200",8),TUEXEC:parseInt("0100",8),TGREAD:parseInt("0040",8),TGWRITE:parseInt("0020",8),TGEXEC:parseInt("0010",8),TOREAD:parseInt("0004",8),TOWRITE:parseInt("0002",8),TOEXEC:parseInt("0001",8),TPERMALL:parseInt("0777",8),TPERMMASK:parseInt("0777",8)}});var j=T((ce,d)=>{"use strict";u();var Q=A(),p=w(),Nr=512,G=p.TPERMALL,rr=0,er=0,H=[["name",100,0,function(r,e){return x(r[e[0]],e[1])},function(r,e,t){return b(r.slice(e,e+t[1]))}],["mode",8,100,function(r,e){var t=r[e[0]]||G;return t=t&p.TPERMMASK,P(t,e[1],G)},function(r,e,t){var n=g(r.slice(e,e+t[1]));return n&=p.TPERMMASK,n}],["uid",8,108,function(r,e){return P(r[e[0]],e[1],rr)},function(r,e,t){return g(r.slice(e,e+t[1]))}],["gid",8,116,function(r,e){return P(r[e[0]],e[1],er)},function(r,e,t){return g(r.slice(e,e+t[1]))}],["size",12,124,function(r,e){return P(r.data.length,e[1])},function(r,e,t){return g(r.slice(e,e+t[1]))}],["modifyTime",12,136,function(r,e){return D(r[e[0]],e[1])},function(r,e,t){return v(r.slice(e,e+t[1]))}],["checksum",8,148,function(r,e){return"        "},function(r,e,t){return g(r.slice(e,e+t[1]))}],["type",1,156,function(r,e){return""+(parseInt(r[e[0]],10)||0)%8},function(r,e,t){return(parseInt(String.fromCharCode(r[e]),10)||0)%8}],["linkName",100,157,function(r,e){return""},function(r,e,t){return b(r.slice(e,e+t[1]))}],["ustar",8,257,function(r,e){return p.TMAGIC},function(r,e,t){return Ur(b(r.slice(e,e+t[1]),!0))},function(r,e){return r[e[0]]==p.TMAGIC||r[e[0]]==p.OLDGNU_MAGIC}],["owner",32,265,function(r,e){return x(r[e[0]],e[1])},function(r,e,t){return b(r.slice(e,e+t[1]))}],["group",32,297,function(r,e){return x(r[e[0]],e[1])},function(r,e,t){return b(r.slice(e,e+t[1]))}],["majorNumber",8,329,function(r,e){return""},function(r,e,t){return g(r.slice(e,e+t[1]))}],["minorNumber",8,337,function(r,e){return""},function(r,e,t){return g(r.slice(e,e+t[1]))}],["prefix",131,345,function(r,e){return x(r[e[0]],e[1])},function(r,e,t){return b(r.slice(e,e+t[1]))}],["accessTime",12,476,function(r,e){return D(r[e[0]],e[1])},function(r,e,t){return v(r.slice(e,e+t[1]))}],["createTime",12,488,function(r,e){return D(r[e[0]],e[1])},function(r,e,t){return v(r.slice(e,e+t[1]))}]],tr=(function(r){var e=r[r.length-1];return e[2]+e[1]})(H);function Ur(r){if(r.length==8){var e=r.split("");if(e[5]==p.NULL_CHAR)return(e[6]==" "||e[6]==p.NULL_CHAR)&&(e[6]="0"),(e[7]==" "||e[7]==p.NULL_CHAR)&&(e[7]="0"),e=e.join(""),e==p.TMAGIC?e:r;if(e[7]==p.NULL_CHAR)return e[5]==p.NULL_CHAR&&(e[5]=" "),e[6]==p.NULL_CHAR&&(e[6]=" "),e==p.OLDGNU_MAGIC?e:r}return r}function x(r,e){return e-=1,Q.isUndefined(r)&&(r=""),r=(""+r).substr(0,e),r+p.NULL_CHAR}function P(r,e,t){for(t=parseInt(t)||0,e-=1,r=(parseInt(r)||t).toString(8).substr(-e,e);r.length<e;)r="0"+r;return r+p.NULL_CHAR}function D(r,e){if(Q.isDateTime(r))r=Math.floor(1*r/1e3);else if(r=parseInt(r,10),isFinite(r)){if(r<=0)return""}else r=Math.floor(1*new Date/1e3);return P(r,e,0)}function b(r,e){var t=String.fromCharCode.apply(null,r);if(e)return t;var n=t.indexOf(p.NULL_CHAR);return n>=0?t.substr(0,n):t}function g(r){var e=String.fromCharCode.apply(null,r);return parseInt(e.replace(/^0+$/g,""),8)||0}function v(r){return r.length==0||r[0]==0?null:new Date(1e3*g(r))}function _r(r,e,t){var n=parseInt(e,10)||0,i=Math.min(n+tr,r.length),a=0,s=0,o=0;t&&H.every(function(y){return y[0]=="checksum"?(s=n+y[2],o=s+y[1],!1):!0});for(var c=32,m=n;m<i;m++){var M=m>=s&&m<o?c:r[m];a=(a+M)%262144}return a}d.exports.recordSize=Nr;d.exports.defaultFileMode=G;d.exports.defaultUid=rr;d.exports.defaultGid=er;d.exports.posixHeader=H;d.exports.effectiveHeaderSize=tr;d.exports.calculateChecksum=_r;d.exports.formatTarString=x;d.exports.formatTarNumber=P;d.exports.formatTarDateTime=D;d.exports.parseTarString=b;d.exports.parseTarNumber=g;d.exports.parseTarDateTime=v});var ar=T((pe,or)=>{"use strict";u();var Dr=w(),C=A(),S=j();function nr(r){return S.recordSize}function ir(r){return Math.ceil(r.data.length/S.recordSize)*S.recordSize}function vr(r){var e=0;return r.forEach(function(t){e+=nr(t)+ir(t)}),e+=S.recordSize*2,new Uint8Array(e)}function Cr(r,e,t){t=parseInt(t)||0;var n=t;S.posixHeader.forEach(function(c){for(var m=c[3](e,c),M=m.length,y=0;y<M;y+=1)r[n+y]=m.charCodeAt(y)&255;n+=c[1]});var i=C.find(S.posixHeader,function(c){return c[0]=="checksum"});if(i){var a=S.calculateChecksum(r,t,!0),s=S.formatTarNumber(a,i[1]-2)+Dr.NULL_CHAR+" ";n=t+i[2];for(var o=0;o<s.length;o+=1)r[n]=s.charCodeAt(o)&255,n++}return t+nr(e)}function Or(r,e,t){return t=parseInt(t,10)||0,r.set(e.data,t),t+ir(e)}function zr(r){r=C.map(r,function(n){return C.extend({},n,{data:C.toUint8Array(n.data)})});var e=vr(r),t=0;return r.forEach(function(n){t=Cr(e,n,t),t=Or(e,n,t)}),e}or.exports.tar=zr});var cr=T((de,sr)=>{"use strict";u();var Ir=w(),q=A(),f=j(),kr={extractData:!0,checkHeader:!0,checkChecksum:!0,checkFileSize:!0},Mr={size:!0,checksum:!0,ustar:!0},B={unexpectedEndOfFile:"Unexpected end of file.",fileCorrupted:"File is corrupted.",checksumCheckFailed:"Checksum check failed."};function Rr(r){return f.recordSize}function Lr(r){return Math.ceil(r/f.recordSize)*f.recordSize}function Gr(r,e){for(var t=e,n=Math.min(r.length,e+f.recordSize*2),i=t;i<n;i++)if(r[i]!=0)return!1;return!0}function Hr(r,e,t){if(r.length-e<f.recordSize){if(t.checkFileSize)throw new Error(B.unexpectedEndOfFile);return null}e=parseInt(e)||0;var n={},i=e;if(f.posixHeader.forEach(function(o){n[o[0]]=o[4](r,i,o),i+=o[1]}),n.type!=0&&(n.size=0),t.checkHeader&&f.posixHeader.forEach(function(o){if(q.isFunction(o[5])&&!o[5](n,o)){var c=new Error(B.fileCorrupted);throw c.data={offset:e+o[2],field:o[0]},c}}),t.checkChecksum){var a=f.calculateChecksum(r,e,!0);if(a!=n.checksum){var s=new Error(B.checksumCheckFailed);throw s.data={offset:e,header:n,checksum:a},s}}return n}function jr(r,e,t,n){return n.extractData?t.size<=0?new Uint8Array:r.slice(e,e+t.size):null}function Br(r,e){var t={};return f.posixHeader.forEach(function(n){var i=n[0];Mr[i]||(t[i]=r[i])}),t.isOldGNUFormat=r.ustar==Ir.OLDGNU_MAGIC,e&&(t.data=e),t}function qr(r,e){e=q.extend({},kr,e);for(var t=[],n=0,i=r.length;i-n>=f.recordSize;){r=q.toUint8Array(r);var a=Hr(r,n,e);if(!a)break;n+=Rr(a);var s=jr(r,n,a,e);if(t.push(Br(a,s)),n+=Lr(a.size),Gr(r,n))break}return t}sr.exports.untar=qr});var pr=T((fe,ur)=>{"use strict";u();var $r=A(),Wr=w(),Yr=ar(),Vr=cr();$r.extend(ur.exports,Yr,Vr,Wr)});var ee={};Sr(ee,{NodeFS:()=>$});module.exports=br(ee);u();var I=E(require("fs"),1),k=E(require("path"),1);u();u();var F=E(pr(),1);async function lr(r,e,t="pgdata",n="auto"){let i=Kr(r,e),[a,s]=await Zr(i,n),o=t+(s?".tar.gz":".tar"),c=s?"application/x-gzip":"application/x-tar";return typeof File<"u"?new File([a],o,{type:c}):new Blob([a],{type:c})}function Xr(r,e){let t=[],n=i=>{r.readdir(i).forEach(s=>{if(s==="."||s==="..")return;let o=i+"/"+s,c=r.stat(o),m=r.isFile(c.mode)?r.readFile(o,{encoding:"binary"}):new Uint8Array(0);t.push({name:o.substring(e.length),mode:c.mode,size:c.size,type:r.isFile(c.mode)?F.REGTYPE:F.DIRTYPE,modifyTime:c.mtime,data:m}),r.isDir(c.mode)&&n(o)})};return n(e),t}function Kr(r,e){let t=Xr(r,e);return(0,F.tar)(t)}async function Zr(r,e="auto"){if(e==="none")return[r,!1];if(typeof CompressionStream<"u")return[await Jr(r),!0];if(typeof process<"u"&&process.versions&&process.versions.node)return[await Qr(r),!0];if(e==="auto")return[r,!1];throw new Error("Compression not supported in this environment")}async function Jr(r){let e=new CompressionStream("gzip"),t=e.writable.getWriter(),n=e.readable.getReader();t.write(r),t.close();let i=[];for(;;){let{value:o,done:c}=await n.read();if(c)break;o&&i.push(o)}let a=new Uint8Array(i.reduce((o,c)=>o+c.length,0)),s=0;return i.forEach(o=>{a.set(o,s),s+=o.length}),a}async function Qr(r){let{promisify:e}=await import("util"),{gzip:t}=await import("zlib");return await e(t)(r)}var re="/tmp/pglite",z=re+"/base",O=class{constructor(e){this.dataDir=e}async init(e,t){return this.pg=e,{emscriptenOpts:t}}async syncToFs(e){}async initialSyncFs(){}async closeFs(){}async dumpTar(e,t){return lr(this.pg.Module.FS,z,e,t)}};var $=class extends O{constructor(e){super(e),this.rootDir=k.resolve(e),I.existsSync(k.join(this.rootDir))||I.mkdirSync(this.rootDir)}async init(e,t){return this.pg=e,{emscriptenOpts:{...t,preRun:[...t.preRun||[],i=>{let a=i.FS.filesystems.NODEFS;i.FS.mkdir(z),i.FS.mount(a,{root:this.rootDir},z)}]}}}async closeFs(){this.pg.Module.FS.quit()}};0&&(module.exports={NodeFS});
//# sourceMappingURL=nodefs.cjs.map