"use strict";var dr=Object.create;var U=Object.defineProperty;var mr=Object.getOwnPropertyDescriptor;var fr=Object.getOwnPropertyNames;var gr=Object.getPrototypeOf,yr=Object.prototype.hasOwnProperty;var hr=(e,r)=>()=>(e&&(r=e(e=0)),r);var E=(e,r)=>()=>(r||e((r={exports:{}}).exports,r),r.exports),Sr=(e,r)=>{for(var t in r)U(e,t,{get:r[t],enumerable:!0})},W=(e,r,t,a)=>{if(r&&typeof r=="object"||typeof r=="function")for(let i of fr(r))!yr.call(e,i)&&i!==t&&U(e,i,{get:()=>r[i],enumerable:!(a=mr(r,i))||a.enumerable});return e};var O=(e,r,t)=>(t=e!=null?dr(gr(e)):{},W(r||!e||!e.__esModule?U(t,"default",{value:e,enumerable:!0}):t,e)),br=e=>W(U({},"__esModule",{value:!0}),e);var p=hr(()=>{"use strict"});var A=E((ie,d)=>{"use strict";p();var Y=9007199254740991,V=(function(e){return e})();function Fr(e){return e===V}function X(e){return typeof e=="string"||Object.prototype.toString.call(e)=="[object String]"}function Tr(e){return Object.prototype.toString.call(e)=="[object Date]"}function _(e){return e!==null&&typeof e=="object"}function v(e){return typeof e=="function"}function Er(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=Y}function wr(e){return Object.prototype.toString.call(e)=="[object Array]"}function K(e){return _(e)&&!v(e)&&Er(e.length)}function I(e){return Object.prototype.toString.call(e)=="[object ArrayBuffer]"}function Ar(e,r){return Array.prototype.map.call(e,r)}function Pr(e,r){var t=V;return v(r)&&Array.prototype.every.call(e,function(a,i,n){var o=r(a,i,n);return o&&(t=a),!o}),t}function Nr(e){return Object.assign.apply(null,arguments)}function Z(e){var r,t,a;if(X(e)){for(t=e.length,a=new Uint8Array(t),r=0;r<t;r++)a[r]=e.charCodeAt(r)&255;return a}return I(e)?new Uint8Array(e):_(e)&&I(e.buffer)?new Uint8Array(e.buffer):K(e)?new Uint8Array(e):_(e)&&v(e.toString)?Z(e.toString()):new Uint8Array}d.exports.MAX_SAFE_INTEGER=Y;d.exports.isUndefined=Fr;d.exports.isString=X;d.exports.isObject=_;d.exports.isDateTime=Tr;d.exports.isFunction=v;d.exports.isArray=wr;d.exports.isArrayLike=K;d.exports.isArrayBuffer=I;d.exports.map=Ar;d.exports.find=Pr;d.exports.extend=Nr;d.exports.toUint8Array=Z});var P=E((ae,J)=>{"use strict";p();var k="\0";J.exports={NULL_CHAR:k,TMAGIC:"ustar"+k+"00",OLDGNU_MAGIC:"ustar  "+k,REGTYPE:0,LNKTYPE:1,SYMTYPE:2,CHRTYPE:3,BLKTYPE:4,DIRTYPE:5,FIFOTYPE:6,CONTTYPE:7,TSUID:parseInt("4000",8),TSGID:parseInt("2000",8),TSVTX:parseInt("1000",8),TUREAD:parseInt("0400",8),TUWRITE:parseInt("0200",8),TUEXEC:parseInt("0100",8),TGREAD:parseInt("0040",8),TGWRITE:parseInt("0020",8),TGEXEC:parseInt("0010",8),TOREAD:parseInt("0004",8),TOWRITE:parseInt("0002",8),TOEXEC:parseInt("0001",8),TPERMALL:parseInt("0777",8),TPERMMASK:parseInt("0777",8)}});var L=E((ce,m)=>{"use strict";p();var Q=A(),l=P(),xr=512,M=l.TPERMALL,rr=0,er=0,R=[["name",100,0,function(e,r){return N(e[r[0]],r[1])},function(e,r,t){return F(e.slice(r,r+t[1]))}],["mode",8,100,function(e,r){var t=e[r[0]]||M;return t=t&l.TPERMMASK,w(t,r[1],M)},function(e,r,t){var a=y(e.slice(r,r+t[1]));return a&=l.TPERMMASK,a}],["uid",8,108,function(e,r){return w(e[r[0]],r[1],rr)},function(e,r,t){return y(e.slice(r,r+t[1]))}],["gid",8,116,function(e,r){return w(e[r[0]],r[1],er)},function(e,r,t){return y(e.slice(r,r+t[1]))}],["size",12,124,function(e,r){return w(e.data.length,r[1])},function(e,r,t){return y(e.slice(r,r+t[1]))}],["modifyTime",12,136,function(e,r){return C(e[r[0]],r[1])},function(e,r,t){return z(e.slice(r,r+t[1]))}],["checksum",8,148,function(e,r){return"        "},function(e,r,t){return y(e.slice(r,r+t[1]))}],["type",1,156,function(e,r){return""+(parseInt(e[r[0]],10)||0)%8},function(e,r,t){return(parseInt(String.fromCharCode(e[r]),10)||0)%8}],["linkName",100,157,function(e,r){return""},function(e,r,t){return F(e.slice(r,r+t[1]))}],["ustar",8,257,function(e,r){return l.TMAGIC},function(e,r,t){return Ur(F(e.slice(r,r+t[1]),!0))},function(e,r){return e[r[0]]==l.TMAGIC||e[r[0]]==l.OLDGNU_MAGIC}],["owner",32,265,function(e,r){return N(e[r[0]],r[1])},function(e,r,t){return F(e.slice(r,r+t[1]))}],["group",32,297,function(e,r){return N(e[r[0]],r[1])},function(e,r,t){return F(e.slice(r,r+t[1]))}],["majorNumber",8,329,function(e,r){return""},function(e,r,t){return y(e.slice(r,r+t[1]))}],["minorNumber",8,337,function(e,r){return""},function(e,r,t){return y(e.slice(r,r+t[1]))}],["prefix",131,345,function(e,r){return N(e[r[0]],r[1])},function(e,r,t){return F(e.slice(r,r+t[1]))}],["accessTime",12,476,function(e,r){return C(e[r[0]],r[1])},function(e,r,t){return z(e.slice(r,r+t[1]))}],["createTime",12,488,function(e,r){return C(e[r[0]],r[1])},function(e,r,t){return z(e.slice(r,r+t[1]))}]],tr=(function(e){var r=e[e.length-1];return r[2]+r[1]})(R);function Ur(e){if(e.length==8){var r=e.split("");if(r[5]==l.NULL_CHAR)return(r[6]==" "||r[6]==l.NULL_CHAR)&&(r[6]="0"),(r[7]==" "||r[7]==l.NULL_CHAR)&&(r[7]="0"),r=r.join(""),r==l.TMAGIC?r:e;if(r[7]==l.NULL_CHAR)return r[5]==l.NULL_CHAR&&(r[5]=" "),r[6]==l.NULL_CHAR&&(r[6]=" "),r==l.OLDGNU_MAGIC?r:e}return e}function N(e,r){return r-=1,Q.isUndefined(e)&&(e=""),e=(""+e).substr(0,r),e+l.NULL_CHAR}function w(e,r,t){for(t=parseInt(t)||0,r-=1,e=(parseInt(e)||t).toString(8).substr(-r,r);e.length<r;)e="0"+e;return e+l.NULL_CHAR}function C(e,r){if(Q.isDateTime(e))e=Math.floor(1*e/1e3);else if(e=parseInt(e,10),isFinite(e)){if(e<=0)return""}else e=Math.floor(1*new Date/1e3);return w(e,r,0)}function F(e,r){var t=String.fromCharCode.apply(null,e);if(r)return t;var a=t.indexOf(l.NULL_CHAR);return a>=0?t.substr(0,a):t}function y(e){var r=String.fromCharCode.apply(null,e);return parseInt(r.replace(/^0+$/g,""),8)||0}function z(e){return e.length==0||e[0]==0?null:new Date(1e3*y(e))}function _r(e,r,t){var a=parseInt(r,10)||0,i=Math.min(a+tr,e.length),n=0,o=0,s=0;t&&R.every(function(h){return h[0]=="checksum"?(o=a+h[2],s=o+h[1],!1):!0});for(var c=32,u=a;u<i;u++){var f=u>=o&&u<s?c:e[u];n=(n+f)%262144}return n}m.exports.recordSize=xr;m.exports.defaultFileMode=M;m.exports.defaultUid=rr;m.exports.defaultGid=er;m.exports.posixHeader=R;m.exports.effectiveHeaderSize=tr;m.exports.calculateChecksum=_r;m.exports.formatTarString=N;m.exports.formatTarNumber=w;m.exports.formatTarDateTime=C;m.exports.parseTarString=F;m.exports.parseTarNumber=y;m.exports.parseTarDateTime=z});var ar=E((pe,or)=>{"use strict";p();var vr=P(),D=A(),S=L();function nr(e){return S.recordSize}function ir(e){return Math.ceil(e.data.length/S.recordSize)*S.recordSize}function Cr(e){var r=0;return e.forEach(function(t){r+=nr(t)+ir(t)}),r+=S.recordSize*2,new Uint8Array(r)}function zr(e,r,t){t=parseInt(t)||0;var a=t;S.posixHeader.forEach(function(c){for(var u=c[3](r,c),f=u.length,h=0;h<f;h+=1)e[a+h]=u.charCodeAt(h)&255;a+=c[1]});var i=D.find(S.posixHeader,function(c){return c[0]=="checksum"});if(i){var n=S.calculateChecksum(e,t,!0),o=S.formatTarNumber(n,i[1]-2)+vr.NULL_CHAR+" ";a=t+i[2];for(var s=0;s<o.length;s+=1)e[a]=o.charCodeAt(s)&255,a++}return t+nr(r)}function Dr(e,r,t){return t=parseInt(t,10)||0,e.set(r.data,t),t+ir(r)}function Or(e){e=D.map(e,function(a){return D.extend({},a,{data:D.toUint8Array(a.data)})});var r=Cr(e),t=0;return e.forEach(function(a){t=zr(r,a,t),t=Dr(r,a,t)}),r}or.exports.tar=Or});var cr=E((de,sr)=>{"use strict";p();var Ir=P(),H=A(),g=L(),kr={extractData:!0,checkHeader:!0,checkChecksum:!0,checkFileSize:!0},Mr={size:!0,checksum:!0,ustar:!0},G={unexpectedEndOfFile:"Unexpected end of file.",fileCorrupted:"File is corrupted.",checksumCheckFailed:"Checksum check failed."};function Rr(e){return g.recordSize}function Lr(e){return Math.ceil(e/g.recordSize)*g.recordSize}function Gr(e,r){for(var t=r,a=Math.min(e.length,r+g.recordSize*2),i=t;i<a;i++)if(e[i]!=0)return!1;return!0}function Hr(e,r,t){if(e.length-r<g.recordSize){if(t.checkFileSize)throw new Error(G.unexpectedEndOfFile);return null}r=parseInt(r)||0;var a={},i=r;if(g.posixHeader.forEach(function(s){a[s[0]]=s[4](e,i,s),i+=s[1]}),a.type!=0&&(a.size=0),t.checkHeader&&g.posixHeader.forEach(function(s){if(H.isFunction(s[5])&&!s[5](a,s)){var c=new Error(G.fileCorrupted);throw c.data={offset:r+s[2],field:s[0]},c}}),t.checkChecksum){var n=g.calculateChecksum(e,r,!0);if(n!=a.checksum){var o=new Error(G.checksumCheckFailed);throw o.data={offset:r,header:a,checksum:n},o}}return a}function jr(e,r,t,a){return a.extractData?t.size<=0?new Uint8Array:e.slice(r,r+t.size):null}function Br(e,r){var t={};return g.posixHeader.forEach(function(a){var i=a[0];Mr[i]||(t[i]=e[i])}),t.isOldGNUFormat=e.ustar==Ir.OLDGNU_MAGIC,r&&(t.data=r),t}function $r(e,r){r=H.extend({},kr,r);for(var t=[],a=0,i=e.length;i-a>=g.recordSize;){e=H.toUint8Array(e);var n=Hr(e,a,r);if(!n)break;a+=Rr(n);var o=jr(e,a,n,r);if(t.push(Br(n,o)),a+=Lr(n.size),Gr(e,a))break}return t}sr.exports.untar=$r});var pr=E((fe,ur)=>{"use strict";p();var qr=A(),Wr=P(),Yr=ar(),Vr=cr();qr.extend(ur.exports,Yr,Vr,Wr)});var ee={};Sr(ee,{BaseFilesystem:()=>$,ERRNO_CODES:()=>q,EmscriptenBuiltinFilesystem:()=>B,PGDATA:()=>x,WASM_PREFIX:()=>lr});module.exports=br(ee);p();p();var T=O(pr(),1);async function j(e,r,t="pgdata",a="auto"){let i=Kr(e,r),[n,o]=await Zr(i,a),s=t+(o?".tar.gz":".tar"),c=o?"application/x-gzip":"application/x-tar";return typeof File<"u"?new File([n],s,{type:c}):new Blob([n],{type:c})}function Xr(e,r){let t=[],a=i=>{e.readdir(i).forEach(o=>{if(o==="."||o==="..")return;let s=i+"/"+o,c=e.stat(s),u=e.isFile(c.mode)?e.readFile(s,{encoding:"binary"}):new Uint8Array(0);t.push({name:s.substring(r.length),mode:c.mode,size:c.size,type:e.isFile(c.mode)?T.REGTYPE:T.DIRTYPE,modifyTime:c.mtime,data:u}),e.isDir(c.mode)&&a(s)})};return a(r),t}function Kr(e,r){let t=Xr(e,r);return(0,T.tar)(t)}async function Zr(e,r="auto"){if(r==="none")return[e,!1];if(typeof CompressionStream<"u")return[await Jr(e),!0];if(typeof process<"u"&&process.versions&&process.versions.node)return[await Qr(e),!0];if(r==="auto")return[e,!1];throw new Error("Compression not supported in this environment")}async function Jr(e){let r=new CompressionStream("gzip"),t=r.writable.getWriter(),a=r.readable.getReader();t.write(e),t.close();let i=[];for(;;){let{value:s,done:c}=await a.read();if(c)break;s&&i.push(s)}let n=new Uint8Array(i.reduce((s,c)=>s+c.length,0)),o=0;return i.forEach(s=>{n.set(s,o),o+=s.length}),n}async function Qr(e){let{promisify:r}=await import("util"),{gzip:t}=await import("zlib");return await r(t)(e)}var lr="/tmp/pglite",x=lr+"/base",B=class{constructor(r){this.dataDir=r}async init(r,t){return this.pg=r,{emscriptenOpts:t}}async syncToFs(r){}async initialSyncFs(){}async closeFs(){}async dumpTar(r,t){return j(this.pg.Module.FS,x,r,t)}},$=class{constructor(r,{debug:t=!1}={}){this.dataDir=r,this.debug=t}async syncToFs(r){}async initialSyncFs(){}async closeFs(){}async dumpTar(r,t){return j(this.pg.Module.FS,x,r,t)}async init(r,t){return this.pg=r,{emscriptenOpts:{...t,preRun:[...t.preRun||[],i=>{let n=re(i,this);i.FS.mkdir(x),i.FS.mount(n,{},x)}]}}}},q={EBADF:8,EBADFD:127,EEXIST:20,EINVAL:28,EISDIR:31,ENODEV:43,ENOENT:44,ENOTDIR:54,ENOTEMPTY:55},re=(e,r)=>{let t=e.FS,a=r.debug?console.log:null,i={tryFSOperation(n){try{return n()}catch(o){throw o.code?o.code==="UNKNOWN"?new t.ErrnoError(q.EINVAL):new t.ErrnoError(o.code):o}},mount(n){return i.createNode(null,"/",16895,0)},syncfs(n,o,s){},createNode(n,o,s,c){if(!t.isDir(s)&&!t.isFile(s))throw new t.ErrnoError(28);let u=t.createNode(n,o,s);return u.node_ops=i.node_ops,u.stream_ops=i.stream_ops,u},getMode:function(n){return a?.("getMode",n),i.tryFSOperation(()=>r.lstat(n).mode)},realPath:function(n){let o=[];for(;n.parent!==n;)o.push(n.name),n=n.parent;return o.push(n.mount.opts.root),o.reverse(),o.join("/")},node_ops:{getattr(n){a?.("getattr",i.realPath(n));let o=i.realPath(n);return i.tryFSOperation(()=>{let s=r.lstat(o);return{...s,dev:0,ino:n.id,nlink:1,rdev:n.rdev,atime:new Date(s.atime),mtime:new Date(s.mtime),ctime:new Date(s.ctime)}})},setattr(n,o){a?.("setattr",i.realPath(n),o);let s=i.realPath(n);i.tryFSOperation(()=>{o.mode!==void 0&&r.chmod(s,o.mode),o.size!==void 0&&r.truncate(s,o.size),o.timestamp!==void 0&&r.utimes(s,o.timestamp,o.timestamp),o.size!==void 0&&r.truncate(s,o.size)})},lookup(n,o){a?.("lookup",i.realPath(n),o);let s=[i.realPath(n),o].join("/"),c=i.getMode(s);return i.createNode(n,o,c)},mknod(n,o,s,c){a?.("mknod",i.realPath(n),o,s,c);let u=i.createNode(n,o,s,c),f=i.realPath(u);return i.tryFSOperation(()=>(t.isDir(u.mode)?r.mkdir(f,{mode:s}):r.writeFile(f,"",{mode:s}),u))},rename(n,o,s){a?.("rename",i.realPath(n),i.realPath(o),s);let c=i.realPath(n),u=[i.realPath(o),s].join("/");i.tryFSOperation(()=>{r.rename(c,u)}),n.name=s},unlink(n,o){a?.("unlink",i.realPath(n),o);let s=[i.realPath(n),o].join("/");try{r.unlink(s)}catch{}},rmdir(n,o){a?.("rmdir",i.realPath(n),o);let s=[i.realPath(n),o].join("/");return i.tryFSOperation(()=>{r.rmdir(s)})},readdir(n){a?.("readdir",i.realPath(n));let o=i.realPath(n);return i.tryFSOperation(()=>r.readdir(o))},symlink(n,o,s){throw a?.("symlink",i.realPath(n),o,s),new t.ErrnoError(63)},readlink(n){throw a?.("readlink",i.realPath(n)),new t.ErrnoError(63)}},stream_ops:{open(n){a?.("open stream",i.realPath(n.node));let o=i.realPath(n.node);return i.tryFSOperation(()=>{t.isFile(n.node.mode)&&(n.shared.refcount=1,n.nfd=r.open(o))})},close(n){return a?.("close stream",i.realPath(n.node)),i.tryFSOperation(()=>{t.isFile(n.node.mode)&&n.nfd&&--n.shared.refcount===0&&r.close(n.nfd)})},dup(n){a?.("dup stream",i.realPath(n.node)),n.shared.refcount++},read(n,o,s,c,u){return a?.("read stream",i.realPath(n.node),s,c,u),c===0?0:i.tryFSOperation(()=>r.read(n.nfd,o,s,c,u))},write(n,o,s,c,u){return a?.("write stream",i.realPath(n.node),s,c,u),i.tryFSOperation(()=>r.write(n.nfd,o.buffer,s,c,u))},llseek(n,o,s){a?.("llseek stream",i.realPath(n.node),o,s);let c=o;if(s===1?c+=n.position:s===2&&t.isFile(n.node.mode)&&i.tryFSOperation(()=>{let u=r.fstat(n.nfd);c+=u.size}),c<0)throw new t.ErrnoError(28);return c},mmap(n,o,s,c,u){if(a?.("mmap stream",i.realPath(n.node),o,s,c,u),!t.isFile(n.node.mode))throw new t.ErrnoError(q.ENODEV);let f=e.mmapAlloc(o);return i.stream_ops.read(n,e.HEAP8,f,o,s),{ptr:f,allocated:!0}},msync(n,o,s,c,u){return a?.("msync stream",i.realPath(n.node),s,c,u),i.stream_ops.write(n,o,0,c,s),0}}};return i};0&&(module.exports={BaseFilesystem,ERRNO_CODES,EmscriptenBuiltinFilesystem,PGDATA,WASM_PREFIX});
//# sourceMappingURL=base.cjs.map